10 ' 外包装箱打印程序
20 ' 泛海数据科技有限公司
30 ' 2019年4月

100 ' INIT
110 BREAK 0, 1 : '按F1键退出
120 BREAK 0 ON
130 ON BREAK 0 GOSUB HANDLECANCEL
140 ON ERROR GOTO HANDLEERR
140 OPEN "console:" AS 1
150 OPEN "uart1:" FOR INPUT AS 2
160 NASC 8
180 DIM PARTS$(13)
210 MARGINX% = 100
220 TOPY% = 1050
230 MARGINX2% = 480
240 MARGINX3% = 768
240 MARGINX4% = 1168
240 LINEHEIGHT% = 112
250 OPTIMIZE "BATCH" ON
260 DIM TITLES$(9)
270 TITLES$(0) = "箱号PKGID"
280 TITLES$(1) = "描述DESC"
290 TITLES$(2) = "编码ITEM"
300 TITLES$(3) = "数量QTY"
310 TITLES$(4) = "代码CODE"
320 TITLES$(5) = "批次号LOT NO"
330 TITLES$(6) = "日期"
340 TITLES$(7) = "供应商型号MPN"
350 TITLES$(8) = "备注"

900 PRINT "RUN LOOP"
910 PRINT #1: PRINT #1, "WAIT COM1"
920 IN$ = ""
930 IN$ = "000000000@1@2@3@4@5@6@7@8@00000 00000@11111 11111@22222 22222@33333 33333"

1000 LOOP: 'LINE INPUT #2, IN$
1010 IF IN$="" THEN BEEP: GOTO LOOP
1020 IF IN$="END" THEN BEEP: GOTO EXIT

1100 C%=SPLIT(IN$,"PARTS$",64) :' @=64 AS separator
1110 IF C%<>13 THEN BEEP: GOTO LOOP

1120 CC$ = ""

1130 FOR I% = 1 TO 30
1140 CC$ = CC$ + "00000000000000000000 "
1150 NEXT I%
1160 PARTS$(9) = CC$: PARTS(10)=CC$: PARTS$(11)=CC$: PARTS$(12)=CC$

1980 ALIGN 7: DIR 4
1990 FONT "FangSong",8,0,100

2000 PRPOS MARGINX%, TOPY%
2010 PRTXT TITLES$(0)
2020 PRPOS MARGINX2%, TOPY%
2030 BARSET "CODE128",2,1,3,80
2040 BARFONT "Univers",6,0,5,1,1,100 ON
2050 PRBAR CODE$
2060 FOR I% = 1 TO 8
2070 PRPOS MARGINX%, TOPY% - LINEHEIGHT% * I%
2080 PRTXT TITLES$(I%) + ":"
2090 PRPOS MARGINX2%, TOPY%  + LINEHEIGHT% * I%
2100 PRTXT PARTS$(I%)
2110 NEXT
2210 BARSET "QRCODE",1,1,4,2,2
2200 PRPOS MARGINX3%, 740
2220 PRBAR PARTS$(9)
2230 PRPOS MARGINX4%, 740
2250 PRBAR PARTS$(10)
2260 PRPOS MARGINX3%, 375
2280 PRBAR PARTS$(11)
2290 PRPOS MARGINX4%, 375 
2320 PRBAR PARTS$(12)

2990 PRINTFEED
3000 'GOTO LOOP

10000 EXIT: ' EXIT
10010 CLOSE 1
10020 CLOSE 2
10030 PRINT "END"
10040 END

15000 HANDLEERR: BEEP: BEEP: BEEP : BEEP: BEEP: BEEP
15010 PRINT "ERROR", ERL, ERR
15020 GOTO EXIT

20000 HANDLECANCEL: ' CANCELED
20010 GOTO EXIT