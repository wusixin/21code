' 内盒打印程序
' 泛海数据科技有限公司
' 2019-4

' 初始化
INIT: PRINT "INIT"
BREAK 0, 1 : '按F1退出
BREAK 0 ON
ON BREAK 0 GOSUB HANDLECANCEL
ON ERROR GOTO HANDLEERR
OPEN "console:" AS 1
OPEN "usb1:" FOR INPUT AS 2
NASC 8
DIM PARTS$(8)
ALIGN 7
DIR 4
MARGINX% = 64
MARGINY% = 100
LINEHEIGHT% = 55
FONT "FangSong",8,0,100
OPTIMIZE "BATCH" ON

PRINT "RUN LOOP"
PRINT #1: PRINT #1, "WAIT DATA"
'IN$ = "2133010516DBJB000600@测试物料，一个很长很长很长很长@很长很长很长很长很长的描述@SJ-RD181@021080@1004101@2019/4/10@备注信息"
IN$ = ""

LOOP: ' BEGIN
LINE INPUT #2, IN$
IF IN$="" THEN BEEP: GOTO LOOP
IF IN$="END" THEN BEEP: GOTO EXIT

C%=SPLIT(IN$,"PARTS$",64) :' @=64 AS separator
IF C%<>8 THEN BEEP: GOTO LOOP
CODE$=PARTS$(0)
ITEM$ = MID$(CODE$,3,8)
DESC1$ = PARTS$(1)
DESC2$ = PARTS$(2)
MPN$=PARTS$(3)
CODE1$=PARTS$(4)
LOTNO$=PARTS$(5)
DATESTR$=PARTS$(6)
MEMO$=PARTS$(7)

PRPOS MARGINX% + LINEHEIGHT% * 0, MARGINY%
PRTXT "编码ITEM:     " + ITEM$
PRPOS MARGINX% + LINEHEIGHT% * 1, MARGINY%
PRTXT "序列号SN:"
PRPOS MARGINX% + LINEHEIGHT% * 1, MARGINY% + 280
BARSET "CODE128",2,1,3,96
BARFONT "Univers",6,0,5,1,1,100 ON
PRBAR CODE$
PRPOS MARGINX% + LINEHEIGHT% * 4, MARGINY%
PRTXT "描述DESC: " + DESC1$
PRPOS MARGINX% + LINEHEIGHT% * 5, MARGINY% + 40
PRTXT DESC2$
PRPOS MARGINX% + LINEHEIGHT% * 6, MARGINY%
PRTXT "供应商型号MPN: " + MPN$
PRPOS MARGINX% + LINEHEIGHT% * 7, MARGINY%
PRTXT "原产地CO: CHINA"
PRPOS MARGINX% + LINEHEIGHT% * 8, MARGINY%
PRTXT "数量QTY: 1PCS"
PRPOS MARGINX% + LINEHEIGHT% * 9, MARGINY%
PRTXT "代码CODE: " + CODE1$
PRPOS MARGINX% + LINEHEIGHT% * 10, MARGINY%
PRTXT "批次号LOT NO: " + LOTNO$
PRPOS MARGINX% + LINEHEIGHT% * 11, MARGINY%
PRTXT "日期: " + DATESTR$
PRPOS MARGINX% + LINEHEIGHT% * 12, MARGINY%
PRTXT "备注: " + MEMO$
PRPOS MARGINX% + LINEHEIGHT% * 9, MARGINY% + 640
PRIMAGE "CE200H.BMP"

PRINTFEED

GOTO LOOP

EXIT: ' EXIT
CLOSE 1
CLOSE 2
PRINT "END"
END

HANDLEERR: BEEP: BEEP: BEEP
PRINT "ERROR", ERL, ERR
GOTO EXIT

HANDLECANCEL: ' CANCEL
PRINT "CANCELED"
GOTO EXIT