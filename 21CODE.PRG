' 21码打印程序
' 泛海数据科技有限公司
' 2019-4

' 初始化
PRINT "INIT":
BREAK 0, 1 : '按F1退出
BREAK 0 ON
ON BREAK 0 GOSUB HANDLECANCEL
ON ERROR GOTO HANDLEERR
OPEN "console:" AS 1
NASC 8
F0$="21"
F1$="33010516"
F2$="DB"
F3$="JB"
START%=1
F4$="R6"
COUNT%=1

' GET INPUT
PRINT #1: PRINT #1, "HUAWEICODE"
LINE INPUT #1, IN$
IF IN$<>"" THEN F1$=IN$
PRINT #1: PRINT #1, "YYMM"
LINE INPUT #1, IN$
IF LEN(IN$)<>4 THEN GOTO ERR_HANDLER
F3$ = CHR$(55 + VAL(LEFT$(IN$,2))) + CHR$(64 + VAL(RIGHT$(IN$,2)))
PRINT #1: PRINT #1, "R6[1/0]"
LINE INPUT #1, IN$
IF IN$="0" THEN F4$=""
PRINT #1: PRINT #1, "START"
LINE INPUT #1, IN$
IF IN$<>"" THEN START%=VAL(IN$)
PRINT #1: PRINT #1, "COUNT"
LINE INPUT #1, IN$
IF IN$<>"" THEN COUNT%=VAL(IN$)

' CONFIRM
ALIGN 7
FONT "Univers",4,0,150
PRPOS 100,40
PRTXT "COUNT=" + STR$(COUNT%) + "  , R6=" + F4$
PRPOS 100,70
PRTXT F0$ + F1$ + F2$ + F3$ + FORMAT$(STR$(START%),"00000#")
PRINTFEED
PRINT #1: PRINT #1, "OK?[1]"
LINE INPUT #1, IN$
' PRINT IN$
IF IN$<>"1" THEN GOSUB HANDLECANCEL

LOOP: ' LOOP BEGIN
' PRINT "RUN LOOP"
ALIGN 7: OPTIMIZE "BATCH" ON
FOR I% = 0 TO COUNT%-1
SER% = START% + I%
CODE$ = F0$ + F1$ + F2$ + F3$ + FORMAT$(STR$(SER%),"00000#")
CLL: BARSET "CODE128",2,1,3,35
PRPOS 100,60
PRBAR CODE$
FONT "Univers",4,0,160
PRPOS 100,25
PRTXT CODE$
PRPOS 600,25
PRTXT F4$
PRINTFEED
NEXT
BEEP

EXIT: ' EXIT
CLOSE 1
PRINT "END"
END

ERR_HANDLER: ' ERR
BEEP: BEEP: BEEP
PRINT "ERROR", ERL, ERR
GOTO EXIT

HANDLECANCEL: ' CANCEL
PRINT "CANCELED"
GOTO EXIT
